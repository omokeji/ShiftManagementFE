<!-- meta tags and other links -->
<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MaxiCare Admin Booking</title>
  <link rel="icon" type="image/png" href="assets/images/favicon.png" sizes="16x16">
  <!-- remix icon font css  -->
  <link rel="stylesheet" href="assets/css/remixicon.css">
  <!-- BootStrap css -->
  <link rel="stylesheet" href="assets/css/lib/bootstrap.min.css">
  <!-- Apex Chart css -->
  <link rel="stylesheet" href="assets/css/lib/apexcharts.css">
  <!-- Data Table css -->
  <link rel="stylesheet" href="assets/css/lib/dataTables.min.css">
  <!-- Text Editor css -->
  <link rel="stylesheet" href="assets/css/lib/editor-katex.min.css">
  <link rel="stylesheet" href="assets/css/lib/editor.atom-one-dark.min.css">
  <link rel="stylesheet" href="assets/css/lib/editor.quill.snow.css">
  <!-- Date picker css -->
  <link rel="stylesheet" href="assets/css/lib/flatpickr.min.css">
  <!-- Calendar css -->
  <link rel="stylesheet" href="assets/css/lib/full-calendar.css">
  <!-- Vector Map css -->
  <link rel="stylesheet" href="assets/css/lib/jquery-jvectormap-2.0.5.css">
  <!-- Popup css -->
  <link rel="stylesheet" href="assets/css/lib/magnific-popup.css">
  <!-- Slick Slider css -->
  <link rel="stylesheet" href="assets/css/lib/slick.css">
  <!-- prism css -->
  <link rel="stylesheet" href="assets/css/lib/prism.css">
  <!-- file upload css -->
  <link rel="stylesheet" href="assets/css/lib/file-upload.css">

  <link rel="stylesheet" href="assets/css/lib/audioplayer.css">
  <!-- main css -->
  <link rel="stylesheet" href="assets/css/style.css">
  <!-- notification fixes css -->
  <link rel="stylesheet" href="assets/css/notification-fixes.css">
  <!-- shift management css -->
  <link rel="stylesheet" href="assets/css/shift-management.css">
</head>

<body>
  <aside class="sidebar">
    <button type="button" class="sidebar-close-btn">
      <iconify-icon icon="radix-icons:cross-2"></iconify-icon>
    </button>
    <div>
      <a href="index.html" class="sidebar-logo">
        <img src="assets/images/logo.png" alt="site logo" class="light-logo">
        <img src="assets/images/logo-light.png" alt="site logo" class="dark-logo">
        <img src="assets/images/logo-icon.png" alt="site logo" class="logo-icon">
      </a>
    </div>
    <div class="sidebar-menu-area">
      <ul class="sidebar-menu" id="sidebar-menu">
        <li>
          <a href="index.html">
            <iconify-icon icon="solar:home-smile-angle-outline" class="menu-icon"></iconify-icon>
            <span>Dashboard</span>
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" class="disabled-link" style="opacity: 0.5; cursor: not-allowed;">
            <iconify-icon icon="solar:calendar-outline" class="menu-icon"></iconify-icon>
            <span>Calendar (Disabled)</span>
          </a>
        </li>
        <li class="dropdown admin-only">
          <a href="javascript:void(0)">
            <iconify-icon icon="flowbite:users-group-outline" class="menu-icon"></iconify-icon>
            <span>Users</span>
          </a>
          <ul class="sidebar-submenu">
            <li>
              <a href="users-list.html"><i class="ri-circle-fill circle-icon text-primary-600 w-auto"></i> Users List</a>
            </li>
            <li>
              <a href="add-user.html"><i class="ri-circle-fill circle-icon text-info-main w-auto"></i> Add User</a>
            </li>
            <li>
              <a href="view-profile.html"><i class="ri-circle-fill circle-icon text-danger-main w-auto"></i> View Profile</a>
            </li>
          </ul>
        </li>

        <li class="dropdown admin-only">
          <a href="javascript:void(0)">
            <i class="ri-user-settings-line text-xl me-14 d-flex w-auto"></i>
            <span>Role & Access</span>
          </a>
          <ul class="sidebar-submenu">
            <li>
              <a href="role-access.html"><i class="ri-circle-fill circle-icon text-primary-600 w-auto"></i> Role & Access</a>
            </li>
            <li>
              <a href="assign-role.html"><i class="ri-circle-fill circle-icon text-warning-main w-auto"></i> Assign Role</a>
            </li>
          </ul>
        </li>

        <li class="dropdown admin-only">
          <a href="javascript:void(0)">
            <iconify-icon icon="solar:clock-circle-outline" class="menu-icon"></iconify-icon>
            <span>Shift Management</span>
          </a>
          <ul class="sidebar-submenu">
            <li>
              <a href="add-shift.html"><i class="ri-circle-fill circle-icon text-primary-600 w-auto"></i> Add Shift</a>
            </li>
            <li>
              <a href="view-shifts.html"><i class="ri-circle-fill circle-icon text-info-main w-auto"></i> View Shifts</a>
            </li>
          <li>
            <a href="clock-change-requests.html"><i class="ri-circle-fill circle-icon text-warning-main w-auto"></i> Clock Change Requests</a>
          </li>
          <li>
            <a href="javascript:void(0)" onclick="showShiftReports()"><i class="ri-circle-fill circle-icon text-info-main w-auto"></i> Shift Reports</a>
          </li>
        </ul>
      </li>

        <li class="dropdown admin-only">
          <a href="javascript:void(0)">
            <iconify-icon icon="solar:briefcase-outline" class="menu-icon"></iconify-icon>
            <span>Job Types</span>
          </a>
          <ul class="sidebar-submenu">
            <li>
              <a href="job-types.html"><i class="ri-circle-fill circle-icon text-primary-600 w-auto"></i> Job Types List</a>
            </li>
            <li>
              <a href="add-job-type.html"><i class="ri-circle-fill circle-icon text-info-main w-auto"></i> Add Job Type</a>
            </li>
          </ul>
        </li>

        <li class="dropdown admin-only">
          <a href="javascript:void(0)">
            <iconify-icon icon="solar:dollar-minimalistic-outline" class="menu-icon"></iconify-icon>
            <span>Payout Management</span>
          </a>
          <ul class="sidebar-submenu">
            <li>
              <a href="payout-management.html"><i class="ri-circle-fill circle-icon text-primary-600 w-auto"></i> Payout Management</a>
            </li>
            <li>
              <a href="employee-payouts.html"><i class="ri-circle-fill circle-icon text-info-main w-auto"></i> Employee Payouts</a>
            </li>
          </ul>
        </li>

        <li class="employee-only">
          <a href="my-shifts.html">
            <iconify-icon icon="solar:clock-circle-outline" class="menu-icon"></iconify-icon>
            <span>My Shifts</span>
          </a>
        </li>

        <li class="employee-only">
          <a href="available-shifts.html">
            <iconify-icon icon="solar:calendar-add-outline" class="menu-icon"></iconify-icon>
            <span>Available Shifts</span>
          </a>
        </li>
      </ul>
    </div>
  </aside>

  <main class="dashboard-main">
    <div class="navbar-header">
      <div class="row align-items-center justify-content-between">
        <div class="col-auto">
          <div class="d-flex flex-wrap align-items-center gap-4">
            <button type="button" class="sidebar-toggle">
              <iconify-icon icon="heroicons:bars-3-solid" class="icon text-2xl non-active"></iconify-icon>
              <iconify-icon icon="iconoir:arrow-right" class="icon text-2xl active"></iconify-icon>
            </button>
            <button type="button" class="sidebar-mobile-toggle">
              <iconify-icon icon="heroicons:bars-3-solid" class="icon"></iconify-icon>
            </button>
            <form class="navbar-search">
              <input type="text" name="search" placeholder="Search">
              <iconify-icon icon="ion:search-outline" class="icon"></iconify-icon>
            </form>
          </div>
        </div>
        <div class="col-auto">
          <div class="d-flex flex-wrap align-items-center gap-3">
            <button type="button" data-theme-toggle
              class="w-40-px h-40-px bg-neutral-200 rounded-circle d-flex justify-content-center align-items-center"></button>

            <div class="dropdown">
              <button
                class="has-indicator w-40-px h-40-px bg-neutral-200 rounded-circle d-flex justify-content-center align-items-center"
                type="button" data-bs-toggle="dropdown">
                <iconify-icon icon="iconoir:bell" class="text-primary-light text-xl"></iconify-icon>
              </button>
              <div class="dropdown-menu to-top dropdown-menu-lg p-0">
                <div
                  class="m-16 py-12 px-16 radius-8 bg-primary-50 mb-16 d-flex align-items-center justify-content-between gap-2">
                  <div>
                    <h6 class="text-lg text-primary-light fw-semibold mb-0">Notifications</h6>
                  </div>
                  <span
                    class="text-primary-600 fw-semibold text-lg w-40-px h-40-px rounded-circle bg-base d-flex justify-content-center align-items-center" id="notificationCount">0</span>
                </div>

                <div class="max-h-400-px overflow-y-auto scroll-sm pe-4" id="notificationsList">
                  <!-- Notifications will be loaded here -->
                  <div class="text-center py-3">
                    <div class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 text-secondary-light text-sm">Loading notifications...</p>
                  </div>
                </div>

                <div class="text-center py-12 px-16">
                  <a href="javascript:void(0)" class="text-primary-600 fw-semibold text-md">See All Notification</a>
                </div>

              </div>
            </div><!-- Notification dropdown end -->

            <div class="dropdown">
              <button class="d-flex justify-content-center align-items-center rounded-circle" type="button"
                data-bs-toggle="dropdown">
                <img src="assets/images/user.png" alt="image" class="w-40-px h-40-px object-fit-cover rounded-circle">
              </button>
              <div class="dropdown-menu to-top dropdown-menu-sm">
                <div
                  class="py-12 px-16 radius-8 bg-primary-50 mb-16 d-flex align-items-center justify-content-between gap-2">
                  <div>
                    <h6 class="text-lg text-primary-light fw-semibold mb-2 user-name">Loading...</h6>
                    <span class="text-secondary-light fw-medium text-sm user-role">Loading...</span>
                  </div>
                  <button type="button" class="hover-text-danger">
                    <iconify-icon icon="radix-icons:cross-1" class="icon text-xl"></iconify-icon>
                  </button>
                </div>
                <ul class="to-top-list">
                  <li>
                    <a class="dropdown-item text-black px-0 py-8 hover-bg-transparent hover-text-primary d-flex align-items-center gap-3"
                      href="view-profile.html">
                      <iconify-icon icon="solar:user-linear" class="icon text-xl"></iconify-icon> My Profile</a>
                  </li>
                  <li>
                    <a class="dropdown-item text-black px-0 py-8 hover-bg-transparent hover-text-primary d-flex align-items-center gap-3"
                      href="email.html">
                      <iconify-icon icon="tabler:message-check" class="icon text-xl"></iconify-icon> Inbox</a>
                  </li>
                  <li>
                    <a class="dropdown-item text-black px-0 py-8 hover-bg-transparent hover-text-primary d-flex align-items-center gap-3"
                      href="company.html">
                      <iconify-icon icon="icon-park-outline:setting-two" class="icon text-xl"></iconify-icon>
                      Setting</a>
                  </li>
                  <li>
                    <a class="dropdown-item text-black px-0 py-8 hover-bg-transparent hover-text-danger d-flex align-items-center gap-3"
                      href="javascript:void(0)" id="logoutBtn">
                      <iconify-icon icon="lucide:power" class="icon text-xl"></iconify-icon> Log Out</a>
                  </li>
                </ul>
              </div>
            </div><!-- Profile dropdown end -->
          </div>
        </div>
      </div>
    </div>

    <div class="dashboard-main-body">
      <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-24">
        <h6 class="fw-semibold mb-0">Dashboard</h6>
        <ul class="d-flex align-items-center gap-2">
          <li class="fw-medium">
            <a href="index.html" class="d-flex align-items-center gap-1 hover-text-primary">
              <iconify-icon icon="solar:home-smile-angle-outline" class="icon text-lg"></iconify-icon>
              Dashboard
            </a>
          </li>
          <li>-</li>
          <li class="fw-medium">AI</li>
        </ul>
      </div>

      <div class="row row-cols-xxl-4 row-cols-xl-3 row-cols-lg-2 row-cols-md-2 row-cols-sm-1 row-cols-1 gy-4">
        <div class="col">
          <div class="card shadow-none border bg-gradient-primary h-100">
            <div class="card-body p-20">
              <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
                <div>
                  <p class="fw-medium text-white mb-1">Total Users</p>
                  <h6 class="mb-0 text-white" id="totalUsers">-</h6>
                </div>
                <div class="w-50-px h-50-px bg-white bg-opacity-20 rounded-circle d-flex justify-content-center align-items-center">
                  <iconify-icon icon="gridicons:multiple-users" class="text-white text-2xl mb-0"></iconify-icon>
                </div>
              </div>
              <p class="fw-medium text-sm text-white mt-12 mb-0 d-flex align-items-center gap-2">
                <span class="d-inline-flex align-items-center gap-1" id="userGrowthTrend">
                  <iconify-icon icon="bxs:up-arrow" class="text-xs"></iconify-icon>
                  <span id="newUsersLast30Days">-</span>
                </span>
                Last 30 days
              </p>
            </div>
          </div><!-- card end -->
        </div>
        <div class="col">
          <div class="card shadow-none border bg-gradient-success h-100">
            <div class="card-body p-20">
              <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
                <div>
                  <p class="fw-medium text-white mb-1">Active Shifts</p>
                  <h6 class="mb-0 text-white" id="activeShifts">-</h6>
                </div>
                <div class="w-50-px h-50-px bg-white bg-opacity-20 rounded-circle d-flex justify-content-center align-items-center">
                  <iconify-icon icon="solar:clock-circle-outline" class="text-white text-2xl mb-0"></iconify-icon>
                </div>
              </div>
              <p class="fw-medium text-sm text-white mt-12 mb-0 d-flex align-items-center gap-2">
                <span class="d-inline-flex align-items-center gap-1" id="shiftTrend">
                  <iconify-icon icon="bxs:up-arrow" class="text-xs"></iconify-icon>
                  <span id="completedShiftsThisMonth">-</span>
                </span>
                Completed this month
              </p>
            </div>
          </div><!-- card end -->
        </div>
        <div class="col">
          <div class="card shadow-none border bg-gradient-info h-100">
            <div class="card-body p-20">
              <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
                <div>
                  <p class="fw-medium text-white mb-1">Total Shifts</p>
                  <h6 class="mb-0 text-white" id="totalShifts">-</h6>
                </div>
                <div class="w-50-px h-50-px bg-white bg-opacity-20 rounded-circle d-flex justify-content-center align-items-center">
                  <iconify-icon icon="solar:calendar-outline" class="text-white text-2xl mb-0"></iconify-icon>
                </div>
              </div>
              <p class="fw-medium text-sm text-white mt-12 mb-0 d-flex align-items-center gap-2">
                <span class="d-inline-flex align-items-center gap-1">
                  <iconify-icon icon="solar:briefcase-outline" class="text-xs"></iconify-icon>
                  <span id="totalJobTypes">-</span>
                </span>
                Job types available
              </p>
            </div>
          </div><!-- card end -->
        </div>
        <div class="col">
          <div class="card shadow-none border bg-gradient-warning h-100">
            <div class="card-body p-20">
              <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
                <div>
                  <p class="fw-medium text-white mb-1">Revenue</p>
                  <h6 class="mb-0 text-white" id="totalRevenue">$0</h6>
                </div>
                <div class="w-50-px h-50-px bg-white bg-opacity-20 rounded-circle d-flex justify-content-center align-items-center">
                  <iconify-icon icon="solar:wallet-bold" class="text-white text-2xl mb-0"></iconify-icon>
                </div>
              </div>
              <p class="fw-medium text-sm text-white mt-12 mb-0 d-flex align-items-center gap-2">
                <span class="d-inline-flex align-items-center gap-1">
                  <iconify-icon icon="solar:chart-outline" class="text-xs"></iconify-icon>
                  <span id="avgRevenuePerShift">$0</span>
                </span>
                Avg per shift
              </p>
            </div>
          </div><!-- card end -->
        </div>
      </div>

      <!-- Recent Activities Section -->
      <div class="row gy-4 mt-4">
        <div class="col-xxl-12">
          <div class="card h-100">
            <div class="card-body p-24">
              <h6 class="mb-12 fw-semibold text-lg mb-16">Recent Activities</h6>
              <div id="recentActivitiesList" class="list-group list-group-flush">
                <!-- Activities will be loaded here -->
              </div>
            </div>
          </div>
        </div>
        <div class="col-xxl-9 col-xl-12">
          <div class="card h-100">
            <div class="card-body p-24">

              <div class="d-flex flex-wrap align-items-center gap-1 justify-content-between mb-16">
                <ul class="nav border-gradient-tab nav-pills mb-0" id="pills-tab" role="tablist">
                  <li class="nav-item" role="presentation">
                    <button class="nav-link d-flex align-items-center active" id="pills-to-do-list-tab"
                      data-bs-toggle="pill" data-bs-target="#pills-to-do-list" type="button" role="tab"
                      aria-controls="pills-to-do-list" aria-selected="true">
                      Registered Employees
                      <span
                        class="text-sm fw-semibold py-6 px-12 bg-neutral-500 rounded-pill text-white line-height-1 ms-12 notification-alert" id="registeredEmployeesCount">-</span>
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link d-flex align-items-center" id="pills-recent-leads-tab" data-bs-toggle="pill"
                      data-bs-target="#pills-recent-leads" type="button" role="tab" aria-controls="pills-recent-leads"
                      aria-selected="false" tabindex="-1">
                      Latest Shift Picked
                      <span
                        class="text-sm fw-semibold py-6 px-12 bg-neutral-500 rounded-pill text-white line-height-1 ms-12 notification-alert" id="latestShiftPickedCount">-</span>
                    </button>
                  </li>
                </ul>
              </div>

                <div class="tab-content" id="pills-tabContent">
                <div class="tab-pane fade show active" id="pills-to-do-list" role="tabpanel"
                  aria-labelledby="pills-to-do-list-tab" tabindex="0">
                  <div class="table-responsive scroll-sm">
                    <table class="table bordered-table sm-table mb-0">
                      <thead>
                        <tr>
                          <th scope="col">Employee Name</th>
                          <th scope="col">Latest Shift</th>
                          <th scope="col">Active Shifts</th>
                          <th scope="col" class="text-center">Weekly Earnings</th>
                        </tr>
                      </thead>
                      <tbody id="recentUsersTableBody">
                        <!-- Recent users will be loaded here -->
                        <tr>
                          <td colspan="4" class="text-center py-3">
                            <div class="spinner-border text-primary" role="status">
                              <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2 text-secondary-light text-sm">Loading recent users...</p>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="tab-pane fade" id="pills-recent-leads" role="tabpanel"
                  aria-labelledby="pills-recent-leads-tab" tabindex="0">
                  <div class="table-responsive scroll-sm">
                    <table class="table bordered-table sm-table mb-0">
                      <thead>
                        <tr>
                          <th scope="col">Shift Details</th>
                          <th scope="col">Date</th>
                          <th scope="col">Status</th>
                          <th scope="col" class="text-center">Employee</th>
                        </tr>
                      </thead>
                      <tbody id="recentShiftsTableBody">
                        <!-- Recent shifts will be loaded here -->
                        <tr>
                          <td colspan="4" class="text-center py-3">
                            <div class="spinner-border text-primary" role="status">
                              <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2 text-secondary-light text-sm">Loading recent shifts...</p>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <footer class="d-footer">
      <div class="row align-items-center justify-content-between">
        <div class="col-auto">
          <p class="mb-0">© 2024 MaxiCare Admin Booking. All Rights Reserved.</p>
        </div>
        <div class="col-auto">
          <p class="mb-0">Made by <span class="text-primary-600">MaxiCare Team</span></p>
        </div>
      </div>
    </footer>
  </main>

  <!-- jQuery library js -->
  <script src="assets/js/lib/jquery-3.7.1.min.js"></script>
  <!-- Bootstrap js -->
  <script src="assets/js/lib/bootstrap.bundle.min.js"></script>
  <!-- Apex Chart js -->
  <script src="assets/js/lib/apexcharts.min.js"></script>
  <!-- Data Table js -->
  <script src="assets/js/lib/dataTables.min.js"></script>
  <!-- Iconify Font js -->
  <script src="assets/js/lib/iconify-icon.min.js"></script>
  <!-- jQuery UI js -->
  <script src="assets/js/lib/jquery-ui.min.js"></script>
  <!-- Vector Map js -->
  <script src="assets/js/lib/jquery-jvectormap-2.0.5.min.js"></script>
  <script src="assets/js/lib/jquery-jvectormap-world-mill-en.js"></script>
  <!-- Popup js -->
  <script src="assets/js/lib/magnifc-popup.min.js"></script>
  <!-- Slick Slider js -->
  <script src="assets/js/lib/slick.min.js"></script>
  <!-- prism js -->
  <script src="assets/js/lib/prism.js"></script>
  <!-- file upload js -->
  <script src="assets/js/lib/file-upload.js"></script>
  <!-- audioplayer -->
  <script src="assets/js/lib/audioplayer.js"></script>

  <!-- API and Auth services -->
  <script src="assets/js/api.js"></script>
  <script src="assets/js/auth.js"></script>
  <script src="assets/js/router.js"></script>
  <script src="assets/js/profile-picture.js"></script>
  <!-- main js -->
  <script src="assets/js/app.js"></script>

  <script>
    // Dashboard initialization
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('Dashboard loading...');
      console.log('Current URL:', window.location.href);
      
      // Simple authentication check - just check storage directly
      const hasToken = localStorage.getItem('maxicare_token') || sessionStorage.getItem('maxicare_token');
      const hasUser = localStorage.getItem('maxicare_user') || sessionStorage.getItem('maxicare_user');
      
      console.log('Direct storage check:', {
        hasToken: !!hasToken,
        hasUser: !!hasUser,
        tokenPreview: hasToken ? hasToken.substring(0, 20) + '...' : 'none'
      });
      
      if (!hasToken || !hasUser) {
        console.log('No authentication data found, redirecting to sign-in');
        window.location.href = 'sign-in.html';
        return;
      }
      
      // Try to initialize auth service if needed
      if (!authService.isLoggedIn()) {
        console.log('Auth service not logged in, trying to reinitialize...');
        authService.init();
        
        // Wait a bit for initialization
        await new Promise(resolve => setTimeout(resolve, 200));
        
        if (!authService.isLoggedIn()) {
          console.log('Still not logged in after reinit, redirecting to sign-in');
          window.location.href = 'sign-in.html';
          return;
        }
      }
      
      console.log('Authentication successful, loading dashboard...');
      
      // Load dashboard data immediately
      await loadDashboardData();

      // Load notifications
      await loadNotifications();

      // Load recent users and shifts tables (10 records each)
      await loadRecentUsersTable();
      await loadRecentShiftsTable();

      // Check if user is admin - redirect employees to their dashboard
      const currentUser = authService.getCurrentUser();
      if (currentUser && (currentUser.role === 'employee' || currentUser.role === 'user')) {
        console.log('Employee trying to access admin dashboard, redirecting...');
        window.location.href = 'employee-dashboard.html';
        return;
      }

      // Setup role-based access control
      setupRoleBasedAccess();

      // Add logout functionality (without confirmation)
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', async function() {
          await authService.logout();
          window.location.href = 'sign-in.html';
        });
      }
    });

    async function loadDashboardData() {
      try {
        console.log('Loading dashboard stats...');
        
        // Check if services are available
        console.log('maxicareAPI available:', typeof maxicareAPI !== 'undefined');
        
        // Use real API only
        if (typeof maxicareAPI !== 'undefined') {
          try {
            console.log('Calling getDashboardStats...');
            const response = await maxicareAPI.getDashboardStats();
            console.log('Dashboard stats response:', response);
            
            if (response && (response.success || response.status)) {
              console.log('Dashboard stats data:', response.data);
              updateDashboardCards(response.data);
              await loadRecentActivities();
              return;
            } else {
              console.error('Dashboard stats failed:', response);
              console.error('Response details:', JSON.stringify(response, null, 2));
            }
          } catch (error) {
            console.error('Error loading dashboard stats:', error);
            console.error('Error details:', {
              message: error.message,
              stack: error.stack,
              name: error.name
            });
            // Show error message to user
            document.getElementById('dashboard-stats').innerHTML = `
              <div class="alert alert-warning">
                <i class="ri-error-warning-line"></i>
                Unable to load dashboard statistics. Please check your connection and try again.
                <br><small>Error: ${error.message}</small>
              </div>
            `;
          }
        }
        
        // If all else fails, show default values
        console.log('All data sources failed, showing default values');
        updateDashboardCards({
          overview: {
            totalUsers: 0,
            totalShifts: 0,
            totalJobTypes: 0,
            activeShifts: 0,
            completedShiftsThisMonth: 0,
            totalRevenue: 0,
            avgRevenuePerShift: 0
          },
          growth: {
            newUsersLast30Days: 0,
            newUsersLast7Days: 0
          }
        });
        
      } catch (error) {
        console.error('Error loading dashboard data:', error);
        // Show default values on error
        updateDashboardCards({
          overview: {
            totalUsers: 0,
            totalShifts: 0,
            totalJobTypes: 0,
            activeShifts: 0,
            completedShiftsThisMonth: 0,
            totalRevenue: 0,
            avgRevenuePerShift: 0
          },
          growth: {
            newUsersLast30Days: 0,
            newUsersLast7Days: 0
          }
        });
      }
    }

    function updateDashboardCards(data) {
      if (!data) return;

      const { overview, growth, trends } = data;

      // Update main cards
      const totalUsersEl = document.getElementById('totalUsers');
      const activeShiftsEl = document.getElementById('activeShifts');
      const totalShiftsEl = document.getElementById('totalShifts');
      const totalJobTypesEl = document.getElementById('totalJobTypes');

      if (totalUsersEl) totalUsersEl.textContent = overview.totalUsers || 0;
      if (activeShiftsEl) activeShiftsEl.textContent = overview.activeShifts || 0;
      if (totalShiftsEl) totalShiftsEl.textContent = overview.totalShifts || 0;
      if (totalJobTypesEl) totalJobTypesEl.textContent = overview.totalJobTypes || 0;

      // Update growth indicators
      const newUsersEl = document.getElementById('newUsersLast30Days');
      const completedShiftsEl = document.getElementById('completedShiftsThisMonth');

      if (newUsersEl) newUsersEl.textContent = growth.newUsersLast30Days || 0;
      if (completedShiftsEl) completedShiftsEl.textContent = overview.completedShiftsThisMonth || 0;

      // Update revenue
      const revenueEl = document.getElementById('totalRevenue');
      const avgRevenueEl = document.getElementById('avgRevenuePerShift');
      
      if (revenueEl) revenueEl.textContent = `$${(overview.totalRevenue || 0).toLocaleString()}`;
      if (avgRevenueEl) avgRevenueEl.textContent = `$${(overview.avgRevenuePerShift || 0).toFixed(0)}`;

      console.log('Dashboard cards updated successfully');
    }

    async function loadRecentActivities() {
      try {
        const response = await maxicareAPI.getRecentActivities(5);
        if (response && response.status) {
          updateRecentActivities(response.data);
        } else {
          console.log('No recent activities data available');
        }
      } catch (error) {
        console.error('Error loading recent activities:', error);
      }
    }

    function updateRecentActivities(data) {
      const activitiesList = document.getElementById('recentActivitiesList');
      if (!activitiesList || !data) return;

      const allActivities = [...(data.recentShifts || []), ...(data.recentUsers || [])];
      
      // Sort by timestamp
      allActivities.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      
      // Take first 5
      const recentActivities = allActivities.slice(0, 5);

      activitiesList.innerHTML = recentActivities.map(activity => `
        <div class="list-group-item d-flex align-items-center gap-3">
          <div class="w-40-px h-40-px bg-primary-50 rounded-circle d-flex justify-content-center align-items-center">
            <iconify-icon icon="${activity.type === 'shift' ? 'solar:clock-circle-outline' : 'solar:user-outline'}" class="text-primary-600"></iconify-icon>
          </div>
          <div class="flex-grow-1">
            <h6 class="mb-1 text-sm fw-semibold">${activity.action}</h6>
            <p class="mb-0 text-xs text-secondary-light">${activity.description}</p>
          </div>
          <span class="text-xs text-secondary-light">${formatTimeAgo(activity.timestamp)}</span>
        </div>
      `).join('');
    }

    function formatTimeAgo(timestamp) {
      const now = new Date();
      const time = new Date(timestamp);
      const diffInMinutes = Math.floor((now - time) / (1000 * 60));
      
      if (diffInMinutes < 1) return 'Just now';
      if (diffInMinutes < 60) return `${diffInMinutes}m ago`;
      if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}h ago`;
      return `${Math.floor(diffInMinutes / 1440)}d ago`;
    }

    async function loadNotifications() {
      try {
        console.log('Loading notifications...');
        
        // Load unread count
        const countResponse = await maxicareAPI.getUnreadNotificationCount();
        if (countResponse && countResponse.status) {
          const countEl = document.getElementById('notificationCount');
          if (countEl) {
            countEl.textContent = countResponse.data.count;
          }
        }

        // Load recent notifications
        const notificationsResponse = await maxicareAPI.getNotifications(1, 5);
        if (notificationsResponse && notificationsResponse.status) {
          updateNotificationsList(notificationsResponse.data.notifications);
        } else {
          showNoNotificationsMessage();
        }
      } catch (error) {
        console.error('Error loading notifications:', error);
        showNoNotificationsMessage();
      }
    }

    function updateNotificationsList(notifications) {
      const notificationsList = document.getElementById('notificationsList');
      if (!notificationsList) return;

      if (notifications.length === 0) {
        showNoNotificationsMessage();
        return;
      }

      notificationsList.innerHTML = notifications.map(notification => `
        <a href="javascript:void(0)" 
           class="px-24 py-12 d-flex align-items-start gap-3 mb-2 justify-content-between ${notification.isRead ? '' : 'bg-neutral-50'}"
           onclick="markNotificationAsRead(${notification.id})">
          <div class="text-black hover-bg-transparent hover-text-primary d-flex align-items-center gap-3">
            <span class="w-44-px h-44-px ${getNotificationIconClass(notification.type)} rounded-circle d-flex justify-content-center align-items-center flex-shrink-0">
              <iconify-icon icon="${getNotificationIcon(notification.type)}" class="icon text-xxl"></iconify-icon>
            </span>
            <div>
              <h6 class="text-md fw-semibold mb-4">${notification.title}</h6>
              <p class="mb-0 text-sm text-secondary-light text-w-200-px">${notification.message}</p>
            </div>
          </div>
          <span class="text-sm text-secondary-light flex-shrink-0">${formatTimeAgo(notification.createdAt)}</span>
        </a>
      `).join('');
    }

    function showNoNotificationsMessage() {
      const notificationsList = document.getElementById('notificationsList');
      if (!notificationsList) return;

      notificationsList.innerHTML = `
        <div class="text-center py-4">
          <iconify-icon icon="solar:bell-outline" class="icon text-4xl text-secondary-light mb-2"></iconify-icon>
          <p class="text-secondary-light mb-0">No notifications</p>
        </div>
      `;
    }

    function getNotificationIcon(type) {
      const iconMap = {
        'shift_assigned': 'solar:clock-circle-outline',
        'shift_completed': 'solar:check-circle-outline',
        'shift_cancelled': 'solar:close-circle-outline',
        'user_registered': 'solar:user-plus-outline',
        'system_announcement': 'solar:megaphone-outline',
        'shift_reminder': 'solar:alarm-outline',
        'payment_processed': 'solar:wallet-outline',
        'profile_updated': 'solar:user-outline',
        'password_changed': 'solar:lock-outline',
        'login_attempt': 'solar:login-3-outline'
      };
      return iconMap[type] || 'solar:bell-outline';
    }

    function getNotificationIconClass(type) {
      const classMap = {
        'shift_assigned': 'bg-primary-subtle text-primary-main',
        'shift_completed': 'bg-success-subtle text-success-main',
        'shift_cancelled': 'bg-danger-subtle text-danger-main',
        'user_registered': 'bg-info-subtle text-info-main',
        'system_announcement': 'bg-warning-subtle text-warning-main',
        'shift_reminder': 'bg-warning-subtle text-warning-main',
        'payment_processed': 'bg-success-subtle text-success-main',
        'profile_updated': 'bg-info-subtle text-info-main',
        'password_changed': 'bg-warning-subtle text-warning-main',
        'login_attempt': 'bg-info-subtle text-info-main'
      };
      return classMap[type] || 'bg-secondary-subtle text-secondary-main';
    }

    async function markNotificationAsRead(notificationId) {
      try {
        await maxicareAPI.markNotificationAsRead(notificationId);
        // Reload notifications to update the UI
        await loadNotifications();
      } catch (error) {
        console.error('Error marking notification as read:', error);
      }
    }

    async function loadRecentUsersTable() {
      try {
        console.log('Loading recent users table...');
        
        // Get users first
        const usersResponse = await maxicareAPI.getUsers(1, 50);
        console.log('Users response:', usersResponse);
        
        if (usersResponse && usersResponse.status) {
          let users = usersResponse.data;
          console.log('Raw users data:', users);
          
          // Filter out admin users
          users = users.filter(user => user.role !== 'admin');
          console.log('Users after admin filter:', users);
          
          // Take only the first 10 non-admin users
          users = users.slice(0, 10);
          console.log('Users after slice:', users);
          
          // Try to get additional data, but don't fail if these calls fail
          try {
            // Get more clock records to ensure we have enough data
            const clockRecordsResponse = await maxicareAPI.getClockInRecords(1, 200);
            // Get more shifts to ensure we have enough data
            const shiftsResponse = await maxicareAPI.getShifts(1, 200);
            
            console.log('Clock records response:', clockRecordsResponse);
            console.log('Shifts response:', shiftsResponse);
            
            // Enhance users with clock records and shift data if available
            if (clockRecordsResponse && clockRecordsResponse.status && shiftsResponse && shiftsResponse.status) {
              users = enhanceUsersWithClockAndShiftData(users, clockRecordsResponse.data, shiftsResponse.data);
              console.log('Users after enhancement:', users);
            } else {
              // Add default values for missing data
              users = users.map(user => ({
                ...user,
                activeShifts: 0,
                latestShift: null,
                weeklyEarnings: 0,
                totalShifts: 0,
                clockRecords: []
              }));
              console.log('Users with default values:', users);
            }
          } catch (enhancementError) {
            console.warn('Could not enhance user data with clock/shift records:', enhancementError);
            // Add default values for missing data
            users = users.map(user => ({
              ...user,
              activeShifts: 0,
              latestShift: null,
              weeklyEarnings: 0,
              totalShifts: 0,
              clockRecords: []
            }));
            console.log('Users with default values after error:', users);
          }
          
          // Always update the table with whatever data we have
          updateRecentUsersTable(users);
        } else {
          console.log('No users response or failed status:', usersResponse);
          showNoUsersMessage();
        }
      } catch (error) {
        console.error('Error loading recent users:', error);
        showNoUsersMessage();
      }
    }

    async function loadRecentShiftsTable() {
      try {
        console.log('Loading recent shifts table...');
        // First get shifts, then get clock-in records to determine active status
        const shiftsResponse = await maxicareAPI.getShifts(1, 10);
        const clockInResponse = await maxicareAPI.getClockInRecords(1, 50); // Get more clock-in records to match with shifts
        
        console.log('Shifts response:', shiftsResponse);
        console.log('Clock-in response:', clockInResponse);
        
        if (shiftsResponse && shiftsResponse.status) {
          let shifts = shiftsResponse.data;
          
          // If we have clock-in data, enhance shifts with active status
          if (clockInResponse && clockInResponse.status) {
            shifts = enhanceShiftsWithClockInData(shifts, clockInResponse.data);
          } else {
            console.warn('Clock-in data not available or invalid, using basic shift data');
            // Extract shifts array and add default values for missing clock-in data
            let shiftsArray = [];
            if (shifts && shifts.shifts && Array.isArray(shifts.shifts)) {
              shiftsArray = shifts.shifts;
            } else if (Array.isArray(shifts)) {
              shiftsArray = shifts;
            }
            
            shifts = shiftsArray.map(shift => ({
              ...shift,
              isActive: false,
              clockInRecords: [],
              latestClockIn: null,
              status: shift.status || 'pending'
            }));
          }
          
          updateRecentShiftsTable(shifts);
        } else {
          console.log('No shifts response or failed status:', shiftsResponse);
          showNoShiftsMessage();
        }
      } catch (error) {
        console.error('Error loading recent shifts:', error);
        showNoShiftsMessage();
      }
    }

    function enhanceUsersWithClockAndShiftData(users, clockRecords, shifts) {
      console.log('enhanceUsersWithClockAndShiftData called with:', { users, clockRecords, shifts });
      
      // Validate input data
      if (!Array.isArray(users)) {
        console.error('users is not an array:', users);
        return [];
      }
      
      // Extract clock records array from the response structure
      let clockRecordsArray = [];
      if (clockRecords && clockRecords.records && Array.isArray(clockRecords.records)) {
        clockRecordsArray = clockRecords.records;
        console.log('Extracted clock records array:', clockRecordsArray);
      } else if (Array.isArray(clockRecords)) {
        clockRecordsArray = clockRecords;
      } else {
        console.error('clockRecords is not in expected format:', clockRecords);
        clockRecordsArray = [];
      }
      
      // Extract shifts array from the response structure
      let shiftsArray = [];
      if (shifts && shifts.shifts && Array.isArray(shifts.shifts)) {
        shiftsArray = shifts.shifts;
        console.log('Extracted shifts array:', shiftsArray);
      } else if (Array.isArray(shifts)) {
        shiftsArray = shifts;
      } else {
        console.error('shifts is not in expected format:', shifts);
        shiftsArray = [];
      }
      
      // Create maps for quick lookup
      const clockRecordsMap = {};
      const shiftsMap = {};
      
      // Group clock records by user ID
      clockRecordsArray.forEach(record => {
        if (record.userId) {
          if (!clockRecordsMap[record.userId]) {
            clockRecordsMap[record.userId] = [];
          }
          clockRecordsMap[record.userId].push(record);
        }
      });
      
      // Group shifts by user ID (shifts are assigned to users via many-to-many relationship)
      shiftsArray.forEach(shift => {
        if (shift.users && Array.isArray(shift.users)) {
          shift.users.forEach(user => {
            if (!shiftsMap[user.id]) {
              shiftsMap[user.id] = [];
            }
            shiftsMap[user.id].push(shift);
          });
        }
      });
      
      console.log('Clock records map:', clockRecordsMap);
      console.log('Shifts map:', shiftsMap);
      
      // Enhance each user with clock and shift data
      return users.map(user => {
        const userClockRecords = clockRecordsMap[user.id] || [];
        const userShifts = shiftsMap[user.id] || [];
        
        // Calculate active shifts (shifts with clock-in but no clock-out)
        const activeShifts = userClockRecords.filter(record => 
          record.clockInTime && !record.clockOutTime
        ).length;
        
        // Get latest shift from clock records (most recent shift user has worked)
        const latestClockRecord = userClockRecords
          .filter(record => record.clockInTime)
          .sort((a, b) => new Date(b.clockInTime) - new Date(a.clockInTime))[0];
        
        const latestShift = latestClockRecord ? latestClockRecord.shift : null;
        
        console.log(`User ${user.id} (${user.firstname || user.username}):`, {
          clockRecords: userClockRecords.length,
          latestClockRecord,
          latestShift,
          activeShifts
        });
        
        // Calculate weekly earnings from clock records (last 7 days)
        const oneWeekAgo = new Date();
        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
        
        const weeklyEarnings = userClockRecords
          .filter(record => {
            const clockInDate = new Date(record.clockInTime);
            return clockInDate >= oneWeekAgo && record.totalEarnings;
          })
          .reduce((total, record) => {
            return total + parseFloat(record.totalEarnings || 0);
          }, 0);
        
        return {
          ...user,
          activeShifts: activeShifts,
          latestShift: latestShift,
          weeklyEarnings: weeklyEarnings,
          totalShifts: userShifts.length,
          clockRecords: userClockRecords
        };
      });
    }

    function enhanceShiftsWithClockInData(shifts, clockInRecords) {
      console.log('enhanceShiftsWithClockInData called with:', { shifts, clockInRecords });
      
      // Extract shifts array from the response structure
      let shiftsArray = [];
      if (shifts && shifts.shifts && Array.isArray(shifts.shifts)) {
        shiftsArray = shifts.shifts;
        console.log('Extracted shifts array:', shiftsArray);
      } else if (Array.isArray(shifts)) {
        shiftsArray = shifts;
      } else {
        console.error('shifts is not in expected format:', shifts);
        return [];
      }
      
      // Extract clock records array from the response structure
      let clockInRecordsArray = [];
      if (clockInRecords && clockInRecords.records && Array.isArray(clockInRecords.records)) {
        clockInRecordsArray = clockInRecords.records;
        console.log('Extracted clock records array:', clockInRecordsArray);
      } else if (Array.isArray(clockInRecords)) {
        clockInRecordsArray = clockInRecords;
      } else {
        console.error('clockInRecords is not in expected format:', clockInRecords);
        // Return shifts with default values if clock records are not available
        return shiftsArray.map(shift => ({
          ...shift,
          isActive: false,
          clockInRecords: [],
          latestClockIn: null,
          status: shift.status || 'pending'
        }));
      }
      
      // Create a map of clock-in records by shift ID for quick lookup
      const clockInMap = {};
      clockInRecordsArray.forEach(record => {
        if (record.shiftId) {
          if (!clockInMap[record.shiftId]) {
            clockInMap[record.shiftId] = [];
          }
          clockInMap[record.shiftId].push(record);
        }
      });

      // Enhance each shift with clock-in data
      return shiftsArray.map(shift => {
        const clockIns = clockInMap[shift.id] || [];
        
        // Determine if shift is active based on clock-in records
        const hasActiveClockIn = clockIns.some(record => 
          record.clockInTime && !record.clockOutTime
        );
        
        // Get the most recent clock-in record for this shift
        const latestClockIn = clockIns
          .filter(record => record.clockInTime)
          .sort((a, b) => new Date(b.clockInTime) - new Date(a.clockInTime))[0];

        return {
          ...shift,
          isActive: hasActiveClockIn,
          clockInRecords: clockIns,
          latestClockIn: latestClockIn,
          status: hasActiveClockIn ? 'active' : (shift.status || 'pending')
        };
      });
    }

    function updateRecentUsersTable(users) {
      
      const tableBody = document.getElementById('recentUsersTableBody');
      const countElement = document.getElementById('registeredEmployeesCount');
      
      if (!tableBody) {
        return;
      }

      if (!users || users.length === 0) {
        console.log('No users to display, showing no users message');
        showNoUsersMessage();
        if (countElement) countElement.textContent = '0';
        return;
      }

      // Update the count
      if (countElement) countElement.textContent = users.length;

      tableBody.innerHTML = users.map(user => `
        <tr>
          <td>
            <div class="d-flex align-items-center">
              <div class="w-40-px h-40-px rounded-circle flex-shrink-0 me-12 bg-primary-subtle text-primary-main d-flex justify-content-center align-items-center">
                <span class="fw-semibold">${(user.firstname || user.username || 'U').charAt(0).toUpperCase()}</span>
              </div>
              <div class="flex-grow-1">
                <h6 class="text-md mb-0 fw-medium">${user.firstname && user.lastname ? `${user.firstname} ${user.lastname}` : user.username || user.email}</h6>
                <span class="text-sm text-secondary-light fw-medium">${user.email}</span>
                <br><small class="text-xs text-secondary-light">Registered: ${formatDate(user.datecreated)}</small>
              </div>
            </div>
          </td>
          <td>
            ${user.latestShift ? `
              <div>
                <span class="text-sm fw-medium">${user.latestShift.job?.title || 'Shift'}</span>
                <br><small class="text-xs text-secondary-light">${formatDate(user.latestShift.date)}</small>
              </div>
            ` : '<span class="text-sm text-secondary-light">No shifts</span>'}
          </td>
          <td>
            <div class="d-flex align-items-center gap-2">
              <span class="badge ${user.activeShifts > 0 ? 'bg-success-50 text-success-600' : 'bg-secondary-50 text-secondary-600'} px-12 py-4 radius-4 fw-medium text-sm">
                ${user.activeShifts}
              </span>
              <small class="text-xs text-secondary-light">active</small>
            </div>
          </td>
          <td class="text-center">
            <span class="text-sm fw-semibold text-success-600">$${user.weeklyEarnings.toFixed(2)}</span>
            <br><small class="text-xs text-secondary-light">this week</small>
          </td>
        </tr>
      `).join('');
    }

    function updateRecentShiftsTable(shifts) {
      console.log('updateRecentShiftsTable called with:', shifts);
      
      const tableBody = document.getElementById('recentShiftsTableBody');
      const countElement = document.getElementById('latestShiftPickedCount');
      
      if (!tableBody) {
        console.error('Table body element not found!');
        return;
      }

      if (!shifts || shifts.length === 0) {
        console.log('No shifts to display, showing no shifts message');
        showNoShiftsMessage();
        if (countElement) countElement.textContent = '0';
        return;
      }

      console.log('Updating table with', shifts.length, 'shifts');
      
      // Update the count
      if (countElement) countElement.textContent = shifts.length;

      tableBody.innerHTML = shifts.map(shift => `
        <tr>
          <td>
            <div class="d-flex align-items-center">
              <div class="flex-grow-1">
                <h6 class="text-md mb-0 fw-medium">${shift.job?.title || 'Shift'}</h6>
                <span class="text-sm text-secondary-light fw-medium">${formatTime(shift.startTime)} - ${formatTime(shift.endTime)}</span>
                ${shift.isActive ? '<span class="badge bg-success-50 text-success-600 px-8 py-2 radius-4 fw-medium text-xs ms-2">Active</span>' : ''}
              </div>
            </div>
          </td>
          <td>${formatDate(shift.date)}</td>
          <td>
            <span class="px-24 py-4 rounded-pill fw-medium text-sm ${getStatusClass(shift.status)}">${shift.status}</span>
            ${shift.latestClockIn ? `<br><small class="text-xs text-secondary-light">Clocked in: ${formatTime(shift.latestClockIn.clockInTime)}</small>` : ''}
          </td>
          <td class="text-center">
            <span class="text-sm">${shift.users?.[0]?.firstname || 'Unassigned'}</span>
          </td>
        </tr>
      `).join('');
    }

    function showNoUsersMessage() {
      const tableBody = document.getElementById('recentUsersTableBody');
      const countElement = document.getElementById('registeredEmployeesCount');
      
      if (!tableBody) return;

      if (countElement) countElement.textContent = '0';

      tableBody.innerHTML = `
        <tr>
          <td colspan="4" class="text-center py-4">
            <iconify-icon icon="solar:user-outline" class="icon text-4xl text-secondary-light mb-2"></iconify-icon>
            <p class="text-secondary-light mb-0">No registered employees found</p>
          </td>
        </tr>
      `;
    }

    function showNoShiftsMessage() {
      const tableBody = document.getElementById('recentShiftsTableBody');
      const countElement = document.getElementById('latestShiftPickedCount');
      
      if (!tableBody) return;

      if (countElement) countElement.textContent = '0';

      tableBody.innerHTML = `
        <tr>
          <td colspan="4" class="text-center py-4">
            <iconify-icon icon="solar:clock-outline" class="icon text-4xl text-secondary-light mb-2"></iconify-icon>
            <p class="text-secondary-light mb-0">No recent shifts</p>
          </td>
        </tr>
      `;
    }

    function getStatusClass(status) {
      const statusMap = {
        'active': 'bg-success-focus text-success-main',
        'completed': 'bg-success-focus text-success-main',
        'in-progress': 'bg-warning-focus text-warning-main',
        'pending': 'bg-info-focus text-info-main',
        'cancelled': 'bg-danger-focus text-danger-main'
      };
      return statusMap[status] || 'bg-secondary-focus text-secondary-main';
    }

    function formatDate(dateString) {
      if (!dateString) return 'N/A';
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
      });
    }

    function formatTime(dateString) {
      if (!dateString) return 'N/A';
      const date = new Date(dateString);
      return date.toLocaleTimeString('en-US', { 
        hour: '2-digit', 
        minute: '2-digit',
        hour12: true
      });
    }

    // Shift Reports functionality - redirect to view-shifts page
    function showShiftReports() {
      window.location.href = 'view-shifts.html';
    }

    function setupRoleBasedAccess() {
      try {
        const currentUser = authService.getCurrentUser();
        if (!currentUser) {
          console.log('No current user found');
          return;
        }

        const isAdmin = currentUser.role === 'admin' || currentUser.role === 'administrator';
        const isUser = currentUser.role === 'user' || currentUser.role === 'employee';

        // Show/hide admin-only elements
        const adminElements = document.querySelectorAll('.admin-only');
        adminElements.forEach(element => {
          element.style.display = isAdmin ? 'block' : 'none';
        });

        // Show/hide employee-only elements (for users/employees)
        const employeeElements = document.querySelectorAll('.employee-only');
        employeeElements.forEach(element => {
          element.style.display = isUser ? 'block' : 'none';
        });

        // Update user info in dropdown
        const userNameElement = document.querySelector('.user-name');
        const userRoleElement = document.querySelector('.user-role');
        if (userNameElement) userNameElement.textContent = `${currentUser.firstname} ${currentUser.lastname}`;
        if (userRoleElement) userRoleElement.textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
        
        console.log('Role-based access setup complete');
      } catch (error) {
        console.error('Error setting up role-based access:', error);
      }
    }
  </script>

</body>
</html>

