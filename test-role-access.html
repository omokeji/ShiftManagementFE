<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Role-Based Access Test - MaxiCare</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3 class="mb-0">Role-Based Access Test</h3>
                    </div>
                    <div class="card-body">
                        <div id="userInfo" class="alert alert-info mb-4">
                            <h5>Current User Info</h5>
                            <div id="userDetails"></div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Admin-Only Functions</h5>
                                <button class="btn btn-primary mb-2 w-100" onclick="testAdminAccess('getUsers')">Get All Users</button>
                                <button class="btn btn-primary mb-2 w-100" onclick="testAdminAccess('getDashboardStats')">Get Dashboard Stats</button>
                                <button class="btn btn-primary mb-2 w-100" onclick="testAdminAccess('createUser')">Create User</button>
                                <button class="btn btn-primary mb-2 w-100" onclick="testAdminAccess('createShift')">Create Shift</button>
                            </div>
                            
                            <div class="col-md-6">
                                <h5>User Functions</h5>
                                <button class="btn btn-success mb-2 w-100" onclick="testUserAccess('getMyShifts')">Get My Shifts</button>
                                <button class="btn btn-success mb-2 w-100" onclick="testUserAccess('getAvailableShifts')">Get Available Shifts</button>
                                <button class="btn btn-success mb-2 w-100" onclick="testUserAccess('getShifts')">Get All Shifts</button>
                                <button class="btn btn-success mb-2 w-100" onclick="testUserAccess('getJobTypes')">Get Job Types</button>
                            </div>
                        </div>
                        
                        <div id="testResults" class="mt-4">
                            <h5>Test Results</h5>
                            <div id="resultsContainer"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/api.js"></script>
    <script src="assets/js/auth.js"></script>
    
    <script>
        let currentUser = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            loadUserInfo();
        });
        
        function loadUserInfo() {
            const userData = localStorage.getItem('maxicare_user') || sessionStorage.getItem('maxicare_user');
        if (userData) {
            currentUser = JSON.parse(userData);
            document.getElementById('userDetails').innerHTML = `
                <p><strong>Name:</strong> ${currentUser.firstname} ${currentUser.lastname}</p>
                <p><strong>Email:</strong> ${currentUser.email}</p>
                <p><strong>Role:</strong> ${currentUser.role}</p>
                <p><strong>Team:</strong> ${currentUser.team || 'N/A'}</p>
                <p><strong>Is Admin:</strong> ${authService.isAdmin()}</p>
                <p><strong>Is Employee/User:</strong> ${authService.isEmployee()}</p>
            `;
        } else {
            document.getElementById('userDetails').innerHTML = '<p class="text-danger">No user logged in</p>';
        }
        }
        
        async function testAdminAccess(functionName) {
            const resultDiv = document.getElementById('resultsContainer');
            const testDiv = document.createElement('div');
            testDiv.className = 'alert alert-info mb-2';
            testDiv.innerHTML = `<strong>Testing ${functionName}...</strong>`;
            resultDiv.appendChild(testDiv);
            
            try {
                let response;
                switch(functionName) {
                    case 'getUsers':
                        response = await maxicareAPI.getUsers();
                        break;
                    case 'getDashboardStats':
                        response = await maxicareAPI.getDashboardStats();
                        break;
                    case 'createUser':
                        response = await maxicareAPI.createUser({
                            username: 'testuser',
                            email: 'test@example.com',
                            firstname: 'Test',
                            lastname: 'User',
                            phone: '1234567890',
                            role: 'user'
                        });
                        break;
                    case 'createShift':
                        response = await maxicareAPI.createShift({
                            title: 'Test Shift',
                            description: 'Test shift description',
                            startTime: '09:00',
                            endTime: '17:00',
                            date: new Date().toISOString().split('T')[0],
                            jobTypeId: 1
                        });
                        break;
                }
                
                testDiv.className = 'alert alert-success mb-2';
                testDiv.innerHTML = `<strong>✅ ${functionName}:</strong> Success - ${JSON.stringify(response).substring(0, 100)}...`;
            } catch (error) {
                testDiv.className = 'alert alert-danger mb-2';
                testDiv.innerHTML = `<strong>❌ ${functionName}:</strong> ${error.message}`;
            }
        }
        
        async function testUserAccess(functionName) {
            const resultDiv = document.getElementById('resultsContainer');
            const testDiv = document.createElement('div');
            testDiv.className = 'alert alert-info mb-2';
            testDiv.innerHTML = `<strong>Testing ${functionName}...</strong>`;
            resultDiv.appendChild(testDiv);
            
            try {
                let response;
                switch(functionName) {
                    case 'getMyShifts':
                        response = await maxicareAPI.getMyShifts();
                        break;
                    case 'getAvailableShifts':
                        response = await maxicareAPI.getAvailableShifts();
                        break;
                    case 'getShifts':
                        response = await maxicareAPI.getShifts();
                        break;
                    case 'getJobTypes':
                        response = await maxicareAPI.getJobTypes();
                        break;
                }
                
                testDiv.className = 'alert alert-success mb-2';
                testDiv.innerHTML = `<strong>✅ ${functionName}:</strong> Success - ${JSON.stringify(response).substring(0, 100)}...`;
            } catch (error) {
                testDiv.className = 'alert alert-danger mb-2';
                testDiv.innerHTML = `<strong>❌ ${functionName}:</strong> ${error.message}`;
            }
        }
    </script>
</body>
</html>
