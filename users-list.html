<!-- meta tags and other links -->
<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Users List - MaxiCare Admin Booking</title>
  <link rel="icon" type="image/png" href="assets/images/favicon.png" sizes="16x16">
  <!-- remix icon font css  -->
  <link rel="stylesheet" href="assets/css/remixicon.css">
  <!-- BootStrap css -->
  <link rel="stylesheet" href="assets/css/lib/bootstrap.min.css">
  <!-- Apex Chart css -->
  <link rel="stylesheet" href="assets/css/lib/apexcharts.css">
  <!-- Data Table css -->
  <link rel="stylesheet" href="assets/css/lib/dataTables.min.css">
  <!-- Text Editor css -->
  <link rel="stylesheet" href="assets/css/lib/editor-katex.min.css">
  <link rel="stylesheet" href="assets/css/lib/editor.atom-one-dark.min.css">
  <link rel="stylesheet" href="assets/css/lib/editor.quill.snow.css">
  <!-- Date picker css -->
  <link rel="stylesheet" href="assets/css/lib/flatpickr.min.css">
  <!-- Calendar css -->
  <link rel="stylesheet" href="assets/css/lib/full-calendar.css">
  <!-- Vector Map css -->
  <link rel="stylesheet" href="assets/css/lib/jquery-jvectormap-2.0.5.css">
  <!-- Popup css -->
  <link rel="stylesheet" href="assets/css/lib/magnific-popup.css">
  <!-- Slick Slider css -->
  <link rel="stylesheet" href="assets/css/lib/slick.css">
  <!-- prism css -->
  <link rel="stylesheet" href="assets/css/lib/prism.css">
  <!-- file upload css -->
  <link rel="stylesheet" href="assets/css/lib/file-upload.css">

  <link rel="stylesheet" href="assets/css/lib/audioplayer.css">
  <!-- main css -->
  <link rel="stylesheet" href="assets/css/style.css">
  <!-- notification fixes css -->
  <link rel="stylesheet" href="assets/css/notification-fixes.css">
</head>

<body>
  <aside class="sidebar">
    <button type="button" class="sidebar-close-btn">
      <iconify-icon icon="radix-icons:cross-2"></iconify-icon>
    </button>
    <div>
      <a href="index.html" class="sidebar-logo">
        <img src="assets/images/logo.png" alt="site logo" class="light-logo">
        <img src="assets/images/logo-light.png" alt="site logo" class="dark-logo">
        <img src="assets/images/logo-icon.png" alt="site logo" class="logo-icon">
      </a>
    </div>
    <div class="sidebar-menu-area">
      <ul class="sidebar-menu" id="sidebar-menu">
        <li>
          <a href="index.html">
            <iconify-icon icon="solar:home-smile-angle-outline" class="menu-icon"></iconify-icon>
            <span>Dashboard</span>
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" class="disabled-link" style="opacity: 0.5; cursor: not-allowed;">
            <iconify-icon icon="solar:calendar-outline" class="menu-icon"></iconify-icon>
            <span>Calendar (Disabled)</span>
          </a>
        </li>
        <li class="dropdown admin-only">
          <a href="javascript:void(0)">
            <iconify-icon icon="flowbite:users-group-outline" class="menu-icon"></iconify-icon>
            <span>Users</span>
          </a>
          <ul class="sidebar-submenu">
            <li>
              <a href="users-list.html"><i class="ri-circle-fill circle-icon text-primary-600 w-auto"></i> Users
                List</a>
            </li>
            <li>
              <a href="add-user.html"><i class="ri-circle-fill circle-icon text-info-main w-auto"></i> Add User</a>
            </li>
            <li>
              <a href="view-profile.html"><i class="ri-circle-fill circle-icon text-danger-main w-auto"></i> View
                Profile</a>
            </li>
          </ul>
        </li>

        <li class="dropdown admin-only">
          <a href="javascript:void(0)">
            <i class="ri-user-settings-line text-xl me-14 d-flex w-auto"></i>
            <span>Role & Access</span>
          </a>
          <ul class="sidebar-submenu">
            <li>
              <a href="role-access.html"><i class="ri-circle-fill circle-icon text-primary-600 w-auto"></i> Role & Access</a>
            </li>
            <li>
              <a href="assign-role.html"><i class="ri-circle-fill circle-icon text-warning-main w-auto"></i> Assign Role</a>
            </li>
          </ul>
        </li>

        <li class="dropdown admin-only">
          <a href="javascript:void(0)">
            <iconify-icon icon="solar:briefcase-outline" class="menu-icon"></iconify-icon>
            <span>Job Types</span>
          </a>
          <ul class="sidebar-submenu">
            <li>
              <a href="job-types.html"><i class="ri-circle-fill circle-icon text-primary-600 w-auto"></i> Job Types List</a>
            </li>
            <li>
              <a href="add-job-type.html"><i class="ri-circle-fill circle-icon text-info-main w-auto"></i> Add Job Type</a>
            </li>
          </ul>
        </li>

        <li class="dropdown admin-only">
          <a href="javascript:void(0)">
            <iconify-icon icon="solar:clock-circle-outline" class="menu-icon"></iconify-icon>
            <span>Shift Management</span>
          </a>
          <ul class="sidebar-submenu">
            <li>
              <a href="add-shift.html"><i class="ri-circle-fill circle-icon text-primary-600 w-auto"></i> Add Shift</a>
            </li>
            <li>
              <a href="view-shifts.html"><i class="ri-circle-fill circle-icon text-info-main w-auto"></i> View Shifts</a>
            </li>
          <li>
            <a href="clock-change-requests.html"><i class="ri-circle-fill circle-icon text-warning-main w-auto"></i> Clock Change Requests</a>
          </li>
          <li>
            <a href="javascript:void(0)" onclick="showShiftReports()"><i class="ri-circle-fill circle-icon text-info-main w-auto"></i> Shift Reports</a>
          </li>
        </ul>
      </li>

        <li class="employee-only">
          <a href="my-shifts.html">
            <iconify-icon icon="solar:clock-circle-outline" class="menu-icon"></iconify-icon>
            <span>My Shifts</span>
          </a>
        </li>

        <li class="employee-only">
          <a href="available-shifts.html">
            <iconify-icon icon="solar:calendar-add-outline" class="menu-icon"></iconify-icon>
            <span>Available Shifts</span>
          </a>
        </li>
      </ul>
    </div>
  </aside>

  <main class="dashboard-main">
    <div class="navbar-header">
      <div class="row align-items-center justify-content-between">
        <div class="col-auto">
          <div class="d-flex flex-wrap align-items-center gap-4">
            <button type="button" class="sidebar-toggle">
              <iconify-icon icon="heroicons:bars-3-solid" class="icon text-2xl non-active"></iconify-icon>
              <iconify-icon icon="iconoir:arrow-right" class="icon text-2xl active"></iconify-icon>
            </button>
            <button type="button" class="sidebar-mobile-toggle">
              <iconify-icon icon="heroicons:bars-3-solid" class="icon"></iconify-icon>
            </button>
            <form class="navbar-search">
              <input type="text" name="search" placeholder="Search">
              <iconify-icon icon="ion:search-outline" class="icon"></iconify-icon>
            </form>
          </div>
        </div>
        <div class="col-auto">
          <div class="d-flex flex-wrap align-items-center gap-3">
            <button type="button" data-theme-toggle
              class="w-40-px h-40-px bg-neutral-200 rounded-circle d-flex justify-content-center align-items-center"></button>

            <div class="dropdown">
              <button
                class="has-indicator w-40-px h-40-px bg-neutral-200 rounded-circle d-flex justify-content-center align-items-center"
                type="button" data-bs-toggle="dropdown">
                <iconify-icon icon="iconoir:bell" class="text-primary-light text-xl"></iconify-icon>
              </button>
              <div class="dropdown-menu to-top dropdown-menu-lg p-0">
                <div
                  class="m-16 py-12 px-16 radius-8 bg-primary-50 mb-16 d-flex align-items-center justify-content-between gap-2">
                  <div>
                    <h6 class="text-lg text-primary-light fw-semibold mb-0">Notifications</h6>
                  </div>
                  <span
                    class="text-primary-600 fw-semibold text-lg w-40-px h-40-px rounded-circle bg-base d-flex justify-content-center align-items-center" id="notificationCount">0</span>
                </div>

                
                <div class="max-h-400-px overflow-y-auto scroll-sm pe-4" id="notificationsList">
                  <!-- Notifications will be loaded here -->
                  <div class="text-center py-3">
                    <div class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 text-secondary-light text-sm">Loading notifications...</p>
                  </div>
                </div>

                <div class="text-center py-12 px-16">
                  <a href="javascript:void(0)" class="text-primary-600 fw-semibold text-md">See All Notification</a>
                </div>

              </div>
            </div><!-- Notification dropdown end -->

            <div class="dropdown">
              <button class="d-flex justify-content-center align-items-center rounded-circle" type="button"
                data-bs-toggle="dropdown">
                <img src="assets/images/user.png" alt="image" class="w-40-px h-40-px object-fit-cover rounded-circle">
              </button>
              <div class="dropdown-menu to-top dropdown-menu-sm">
                <div
                  class="py-12 px-16 radius-8 bg-primary-50 mb-16 d-flex align-items-center justify-content-between gap-2">
                  <div>
                    <h6 class="text-lg text-primary-light fw-semibold mb-2 user-name">Loading...</h6>
                    <span class="text-secondary-light fw-medium text-sm user-role">Loading...</span>
                  </div>
                  <button type="button" class="hover-text-danger">
                    <iconify-icon icon="radix-icons:cross-1" class="icon text-xl"></iconify-icon>
                  </button>
                </div>
                <ul class="to-top-list">
                  <li>
                    <a class="dropdown-item text-black px-0 py-8 hover-bg-transparent hover-text-primary d-flex align-items-center gap-3"
                      href="view-profile.html">
                      <iconify-icon icon="solar:user-linear" class="icon text-xl"></iconify-icon> My Profile</a>
                  </li>
                  <li>
                    <a class="dropdown-item text-black px-0 py-8 hover-bg-transparent hover-text-primary d-flex align-items-center gap-3"
                      href="email.html">
                      <iconify-icon icon="tabler:message-check" class="icon text-xl"></iconify-icon> Inbox</a>
                  </li>
                  <li>
                    <a class="dropdown-item text-black px-0 py-8 hover-bg-transparent hover-text-primary d-flex align-items-center gap-3"
                      href="company.html">
                      <iconify-icon icon="icon-park-outline:setting-two" class="icon text-xl"></iconify-icon>
                      Setting</a>
                  </li>
                  <li>
                    <a class="dropdown-item text-black px-0 py-8 hover-bg-transparent hover-text-danger d-flex align-items-center gap-3"
                      href="javascript:void(0)" id="logoutBtn">
                      <iconify-icon icon="lucide:power" class="icon text-xl"></iconify-icon> Log Out</a>
                  </li>
                </ul>
              </div>
            </div><!-- Profile dropdown end -->
          </div>
        </div>
      </div>
    </div>

    <div class="dashboard-main-body">
      <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-24">
        <h6 class="fw-semibold mb-0">Users List</h6>
        <ul class="d-flex align-items-center gap-2">
          <li class="fw-medium">
            <a href="index.html" class="d-flex align-items-center gap-1 hover-text-primary">
              <iconify-icon icon="solar:home-smile-angle-outline" class="icon text-lg"></iconify-icon>
              Dashboard
            </a>
          </li>
          <li>-</li>
          <li class="fw-medium">Users List</li>
        </ul>
      </div>

      <div class="card h-100 p-0 radius-12">
        <div
          class="card-header border-bottom bg-base py-16 px-24 d-flex align-items-center flex-wrap gap-3 justify-content-between">
          <div class="d-flex align-items-center flex-wrap gap-3">
            <span class="text-md fw-medium text-secondary-light mb-0">Show</span>
            <select class="form-select form-select-sm w-auto ps-12 py-6 radius-12 h-40-px">
              <option>1</option>
              <option>2</option>
              <option>3</option>
              <option>4</option>
              <option>5</option>
              <option>6</option>
              <option>7</option>
              <option>8</option>
              <option>9</option>
              <option>10</option>
            </select>
            <form class="navbar-search">
              <input type="text" class="bg-base h-40-px w-auto" name="search" placeholder="Search">
              <iconify-icon icon="ion:search-outline" class="icon"></iconify-icon>
            </form>
            <select class="form-select form-select-sm w-auto ps-12 py-6 radius-12 h-40-px">
              <option>Status</option>
              <option>Active</option>
              <option>Inactive</option>
            </select>
          </div>
          <a href="add-user.html"
            class="btn btn-primary text-sm btn-sm px-12 py-12 radius-8 d-flex align-items-center gap-2">
            <iconify-icon icon="ic:baseline-plus" class="icon text-xl line-height-1"></iconify-icon>
            Add New User
          </a>
        </div>
        <div class="card-body p-24">
          <div class="table-responsive scroll-sm">
            <table class="table bordered-table sm-table mb-0" id="usersTable">
              <thead>
                <tr>
                  <th scope="col">
                    <div class="d-flex align-items-center gap-10">
                      <div class="form-check style-check d-flex align-items-center">
                        <input class="form-check-input radius-4 border input-form-dark" type="checkbox" name="checkbox"
                          id="selectAll">
                      </div>
                      S.L
                    </div>
                  </th>
                  <th scope="col">Join Date</th>
                  <th scope="col">Name</th>
                  <th scope="col">Email</th>
                  <th scope="col">Department</th>
                  <th scope="col">Designation</th>
                  <th scope="col" class="text-center">Status</th>
                  <th scope="col" class="text-center">Action</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
                <!-- Data will be loaded dynamically -->
              </tbody>
            </table>
          </div>

          <!-- DataTables will handle pagination automatically -->
        </div>
      </div>
    </div>

    <footer class="d-footer">
      <div class="row align-items-center justify-content-between">
        <div class="col-auto">
          <p class="mb-0">© 2024 MaxiCare Admin Booking. All Rights Reserved.</p>
        </div>
        <div class="col-auto">
          <p class="mb-0">Made by <span class="text-primary-600">MaxiCare Team</span></p>
        </div>
      </div>
    </footer>
  </main>
  <!-- jQuery library js -->
  <script src="assets/js/lib/jquery-3.7.1.min.js"></script>
  <!-- Bootstrap js -->
  <script src="assets/js/lib/bootstrap.bundle.min.js"></script>
  <!-- Apex Chart js -->
  <script src="assets/js/lib/apexcharts.min.js"></script>
  <!-- Data Table js -->
  <script src="assets/js/lib/dataTables.min.js"></script>
  <!-- Iconify Font js -->
  <script src="assets/js/lib/iconify-icon.min.js"></script>
  <!-- jQuery UI js -->
  <script src="assets/js/lib/jquery-ui.min.js"></script>
  <!-- Vector Map js -->
  <script src="assets/js/lib/jquery-jvectormap-2.0.5.min.js"></script>
  <script src="assets/js/lib/jquery-jvectormap-world-mill-en.js"></script>
  <!-- Popup js -->
  <script src="assets/js/lib/magnifc-popup.min.js"></script>
  <!-- Slick Slider js -->
  <script src="assets/js/lib/slick.min.js"></script>
  <!-- prism js -->
  <script src="assets/js/lib/prism.js"></script>
  <!-- file upload js -->
  <script src="assets/js/lib/file-upload.js"></script>
  <!-- audioplayer -->
  <script src="assets/js/lib/audioplayer.js"></script>

  <!-- API and Auth services -->
  <script src="assets/js/api.js"></script>
  <script src="assets/js/auth.js"></script>
  <script src="assets/js/router.js"></script>
  <!-- main js -->
  <script src="assets/js/app.js"></script>

  <script>
    // Users list management
    let users = [];

    document.addEventListener('DOMContentLoaded', async function() {
      // Wait for authentication to be ready
      const isAuthReady = await authService.waitForAuth();
      if (!isAuthReady) {
        console.log('Authentication not ready, redirecting to sign-in');
        window.location.href = 'sign-in.html';
        return;
      }
      
      // Check authentication and admin role
      if (!authService.requireAuth()) {
        return;
      }

      if (!authService.isAdmin()) {
        alert('Access denied. Admin privileges required.');
        window.location.href = 'index.html';
        return;
      }

      // Add logout functionality
      document.getElementById('logoutBtn').addEventListener('click', async function() {
        await authService.logout();
        window.location.href = 'sign-in.html';
      });

      // Load users data
      await loadUsers();
    });

    async function loadUsers() {
      try {
        const response = await maxicareAPI.getUsers();
        if (response.status) {
          users = response.data;
          renderUsersTable();
        } else {
          console.error('Failed to load users:', response.message);
        }
      } catch (error) {
        console.error('Error loading users:', error);
        alert('Failed to load users. Please try again.');
      }
    }

    function renderUsersTable() {
      const tbody = document.getElementById('usersTableBody');
      if (!tbody) return;

      tbody.innerHTML = '';

      if (users.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8" class="text-center py-5">
              <div class="d-flex flex-column align-items-center">
                <p class="text-secondary-light mb-0">No users found</p>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      users.forEach((user, index) => {
        const row = createUserRow(user, index + 1);
        tbody.appendChild(row);
      });

      // Initialize DataTable after data is loaded
      initializeDataTable();
    }

    // Initialize DataTable
    function initializeDataTable() {
      if ($.fn.DataTable && !$.fn.DataTable.isDataTable('#usersTable')) {
        $('#usersTable').DataTable({
          responsive: true,
          pageLength: 10,
          order: [[1, 'desc']] // Sort by date descending
        });
      }
    }

    function createUserRow(user, index) {
      const tr = document.createElement('tr');
      const statusClass = user.active ? 'bg-success-focus text-success-600 border border-success-main' : 'bg-neutral-200 text-neutral-600 border border-neutral-400';
      const statusText = user.active ? 'Active' : 'Inactive';
      const lastLogin = user.lastlogin ? new Date(user.lastlogin).toLocaleDateString() : 'Never';
      
      tr.innerHTML = `
        <td>
          <div class="d-flex align-items-center gap-10">
            <div class="form-check style-check d-flex align-items-center">
              <input class="form-check-input radius-4 border border-neutral-400" type="checkbox" name="checkbox">
            </div>
            ${index.toString().padStart(2, '0')}
          </div>
        </td>
        <td>${formatDate(user.datecreated)}</td>
        <td>
          <div class="d-flex align-items-center">
            <div class="w-40-px h-40-px bg-primary-100 rounded-circle d-flex justify-content-center align-items-center me-12">
              <span class="text-primary-600 fw-semibold">${user.firstname.charAt(0)}${user.lastname.charAt(0)}</span>
            </div>
            <div class="flex-grow-1">
              <span class="text-md mb-0 fw-normal text-secondary-light">${user.firstname} ${user.lastname}</span>
            </div>
          </div>
        </td>
        <td><span class="text-md mb-0 fw-normal text-secondary-light">${user.email}</span></td>
        <td>${user.team || 'N/A'}</td>
        <td>${user.title || 'N/A'}</td>
        <td class="text-center">
          <span class="${statusClass} px-24 py-4 radius-4 fw-medium text-sm">${statusText}</span>
        </td>
        <td class="text-center">
          <div class="d-flex align-items-center gap-10 justify-content-center">
            <button type="button" class="bg-info-focus bg-hover-info-200 text-info-600 fw-medium w-40-px h-40-px d-flex justify-content-center align-items-center rounded-circle" onclick="viewUser(${user.id})" title="View User">
              <iconify-icon icon="majesticons:eye-line" class="icon text-xl"></iconify-icon>
            </button>
            <button type="button" class="bg-success-focus text-success-600 bg-hover-success-200 fw-medium w-40-px h-40-px d-flex justify-content-center align-items-center rounded-circle" onclick="editUser(${user.id})" title="Edit User">
              <iconify-icon icon="lucide:edit" class="menu-icon"></iconify-icon>
            </button>
            <button type="button" class="remove-item-btn bg-danger-focus bg-hover-danger-200 text-danger-600 fw-medium w-40-px h-40-px d-flex justify-content-center align-items-center rounded-circle" onclick="deleteUser(${user.id})" title="Delete User">
              <iconify-icon icon="fluent:delete-24-regular" class="menu-icon"></iconify-icon>
            </button>
          </div>
        </td>
      `;
      
      return tr;
    }

    function formatDate(dateString) {
      if (!dateString) return 'N/A';
      const date = new Date(dateString);
      return date.toLocaleDateString('en-GB', {
        day: '2-digit',
        month: 'short',
        year: 'numeric'
      });
    }

    async function viewUser(userId) {
      try {
        const response = await maxicareAPI.getUser(userId);
        if (response.status) {
          const user = response.data;
          
          // Create a detailed view modal
          const modalHtml = `
            <div class="modal fade" id="viewUserModal" tabindex="-1">
              <div class="modal-dialog modal-lg">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">User Details - ${user.firstname} ${user.lastname}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                  </div>
                  <div class="modal-body">
                    <div class="row">
                      <div class="col-md-6">
                        <h6>Personal Information</h6>
                        <p><strong>Name:</strong> ${user.firstname} ${user.lastname}</p>
                        <p><strong>Username:</strong> ${user.username}</p>
                        <p><strong>Email:</strong> ${user.email}</p>
                        <p><strong>Phone:</strong> ${user.phone || 'Not provided'}</p>
                      </div>
                      <div class="col-md-6">
                        <h6>Work Information</h6>
                        <p><strong>Title:</strong> ${user.title || 'Not provided'}</p>
                        <p><strong>Role:</strong> <span class="badge bg-${user.role === 'admin' ? 'primary' : 'info'}">${user.role.charAt(0).toUpperCase() + user.role.slice(1)}</span></p>
                        <p><strong>Team:</strong> ${user.team || 'Not assigned'}</p>
                        <p><strong>Manager:</strong> ${user.directmanager || 'Not assigned'}</p>
                      </div>
                    </div>
                    <div class="row mt-3">
                      <div class="col-md-6">
                        <h6>Status Information</h6>
                        <p><strong>Status:</strong> <span class="badge bg-${user.active ? 'success' : 'danger'}">${user.active ? 'Active' : 'Inactive'}</span></p>
                        <p><strong>Employment Start:</strong> ${user.employmentstartdate ? new Date(user.employmentstartdate).toLocaleDateString() : 'Not provided'}</p>
                      </div>
                      <div class="col-md-6">
                        <h6>Account Information</h6>
                        <p><strong>Last Login:</strong> ${user.lastlogin ? new Date(user.lastlogin).toLocaleString() : 'Never'}</p>
                        <p><strong>Date Created:</strong> ${new Date(user.datecreated).toLocaleDateString()}</p>
                      </div>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>
          `;

          // Remove existing modal if any
          const existingModal = document.getElementById('viewUserModal');
          if (existingModal) {
            existingModal.remove();
          }

          // Add modal to body
          document.body.insertAdjacentHTML('beforeend', modalHtml);

          // Show modal
          const modal = new bootstrap.Modal(document.getElementById('viewUserModal'));
          modal.show();

          // Remove modal from DOM when hidden
          document.getElementById('viewUserModal').addEventListener('hidden.bs.modal', function() {
            this.remove();
          });
        }
      } catch (error) {
        alert('Failed to load user details: ' + error.message);
      }
    }

    async function editUser(userId) {
      // Redirect to add-user.html with edit mode
      window.location.href = `add-user.html?edit=${userId}`;
    }

    async function deleteUser(userId) {
      if (!confirm('Are you sure you want to delete this user?')) {
        return;
      }

      try {
        const response = await maxicareAPI.deleteUser(userId);
        if (response.status) {
          alert('User deleted successfully');
          await loadUsers(); // Reload the users list
        } else {
          alert('Failed to delete user: ' + response.message);
        }
      } catch (error) {
        alert('Failed to delete user: ' + error.message);
      }
    }

    // Original remove functionality for demo data
    $('.remove-item-btn').on('click', function () {
      $(this).closest('tr').addClass('d-none')
    }); 
  </script>


  <script>
    // Notification functions
    async function loadNotifications() {
      try {
        console.log('Loading notifications...');
        
        // Load unread count
        const countResponse = await maxicareAPI.getUnreadNotificationCount();
        if (countResponse && countResponse.status) {
          const countEl = document.getElementById('notificationCount');
          if (countEl) {
            countEl.textContent = countResponse.data.count;
          }
        }

        // Load recent notifications
        const notificationsResponse = await maxicareAPI.getNotifications(1, 5);
        if (notificationsResponse && notificationsResponse.status) {
          updateNotificationsList(notificationsResponse.data.notifications);
        } else {
          showNoNotificationsMessage();
        }
      } catch (error) {
        console.error('Error loading notifications:', error);
        showNoNotificationsMessage();
      }
    }

    function updateNotificationsList(notifications) {
      const notificationsList = document.getElementById('notificationsList');
      if (!notificationsList) return;

      if (notifications.length === 0) {
        showNoNotificationsMessage();
        return;
      }

      notificationsList.innerHTML = notifications.map(notification => `
        <a href="javascript:void(0)" 
           class="px-24 py-12 d-flex align-items-start gap-3 mb-2 justify-content-between ${notification.isRead ? '' : 'bg-neutral-50'}"
           onclick="markNotificationAsRead(${notification.id})">
          <div class="text-black hover-bg-transparent hover-text-primary d-flex align-items-center gap-3">
            <span class="w-44-px h-44-px ${getNotificationIconClass(notification.type)} rounded-circle d-flex justify-content-center align-items-center flex-shrink-0">
              <iconify-icon icon="${getNotificationIcon(notification.type)}" class="icon text-xxl"></iconify-icon>
            </span>
            <div>
              <h6 class="text-md fw-semibold mb-4">${notification.title}</h6>
              <p class="mb-0 text-sm text-secondary-light text-w-200-px">${notification.message}</p>
            </div>
          </div>
          <span class="text-sm text-secondary-light flex-shrink-0">${formatTimeAgo(notification.createdAt)}</span>
        </a>
      `).join('');
    }

    function showNoNotificationsMessage() {
      const notificationsList = document.getElementById('notificationsList');
      if (!notificationsList) return;

      notificationsList.innerHTML = `
        <div class="text-center py-4">
          <iconify-icon icon="solar:bell-outline" class="icon text-4xl text-secondary-light mb-2"></iconify-icon>
          <p class="text-secondary-light mb-0">No notifications</p>
        </div>
      `;
    }

    function getNotificationIcon(type) {
      const iconMap = {
        'shift_assigned': 'solar:clock-circle-outline',
        'shift_completed': 'solar:check-circle-outline',
        'shift_cancelled': 'solar:close-circle-outline',
        'user_registered': 'solar:user-plus-outline',
        'system_announcement': 'solar:megaphone-outline',
        'shift_reminder': 'solar:alarm-outline',
        'payment_processed': 'solar:wallet-outline',
        'profile_updated': 'solar:user-outline',
        'password_changed': 'solar:lock-outline',
        'login_attempt': 'solar:login-3-outline'
      };
      return iconMap[type] || 'solar:bell-outline';
    }

    function getNotificationIconClass(type) {
      const classMap = {
        'shift_assigned': 'bg-primary-subtle text-primary-main',
        'shift_completed': 'bg-success-subtle text-success-main',
        'shift_cancelled': 'bg-danger-subtle text-danger-main',
        'user_registered': 'bg-info-subtle text-info-main',
        'system_announcement': 'bg-warning-subtle text-warning-main',
        'shift_reminder': 'bg-warning-subtle text-warning-main',
        'payment_processed': 'bg-success-subtle text-success-main',
        'profile_updated': 'bg-info-subtle text-info-main',
        'password_changed': 'bg-warning-subtle text-warning-main',
        'login_attempt': 'bg-info-subtle text-info-main'
      };
      return classMap[type] || 'bg-secondary-subtle text-secondary-main';
    }

    async function markNotificationAsRead(notificationId) {
      try {
        await maxicareAPI.markNotificationAsRead(notificationId);
        // Reload notifications to update the UI
        await loadNotifications();
      } catch (error) {
        console.error('Error marking notification as read:', error);
      }
    }

    function formatTimeAgo(dateString) {
      if (!dateString) return 'N/A';
      const date = new Date(dateString);
      const now = new Date();
      const diffInMinutes = Math.floor((now - date) / (1000 * 60));
      if (diffInMinutes < 1) return 'Just now';
      if (diffInMinutes < 60) return `${diffInMinutes}m ago`;
      if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}h ago`;
      return `${Math.floor(diffInMinutes / 1440)}d ago`;
    }

    // Shift Reports functionality - redirect to view-shifts page
    function showShiftReports() {
      window.location.href = 'view-shifts.html';
    }
  </script>
</body>

</html>
